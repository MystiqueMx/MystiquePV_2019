@model MystiqueMC.Models.Rubros.RubrosIndexViewModel

@{
    ViewBag.Title = "Index";
    var controllerName = this.ViewContext.RouteData.Values["controller"].ToString();
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-md-12">
        <h2>Rubros</h2>
    </div>
</div>
<br />

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-md-12">
                            <a class="btn btn-link" href="@Url.Action("Create")" style="float:right;">
                                <i class="fas fa-plus-square m-r-xs " style="color:#616161; font-size:12pt"></i>
                                <b>Agregar rubro</b>
                            </a>
                        </div>
                    </div>
                    <div class="row" style="clear: both;">
                        <div class="col-md-6">
                            <label>Costos</label>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="input-group">
                                        <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;font-size: 12px;"><b>Estatus</b></span>
                                        <select class="form-control input-sm filtro-estatus-rubro" aria-describedby="basic-addon1" name="SearchOrden" data-esCostos="true">
                                            <option selected="selected" value="true">Activo</option>
                                            <option value="false">Inactivo</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <button class="btn btn-primary btn-buscar-rubro" type="button" data-esCostos="true"><i class="fa fa-search"></i></button>
                                </div>
                            </div>
                            <div id="egresos-costos"></div>
                        </div>
                        <div class="col-md-6">
                            <label>Gastos</label>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="input-group">
                                        <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;font-size: 12px;"><b>Estatus</b></span>
                                        <select class="form-control input-sm filtro-estatus-rubro" aria-describedby="basic-addon1" name="SearchOrden" data-esCostos="false">
                                            <option selected="selected" value="true">Activo</option>
                                            <option value="false">Inactivo</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary btn-buscar-rubro" type="button" data-esCostos="false"><i class="fa fa-search"></i></button>
                                </div>
                                <div class="col-md-5">
                                    <div style="float: right;">
                                        @*<a id="btn_AgregarConcepto" href="@Url.Action("Create", "CatConceptosGastos")" class="btn btn-link" >*@
                                        <a id="btn_AgregarConcepto" class="btn btn-link">
                                            <i class="fas fa-plus-square m-r-xs " style="color:#616161; font-size:12pt"></i>
                                            <b>Agregar concepto</b>
                                        </a>

                                    </div>
                                </div>
                            </div>
                            <div id="egresos-gastos"></div>
                        </div>
                    </div><br />
                </div><br />
                <div class="form-group">
                    <div class="col-md-10" style="padding:0pt">
                        @Html.ActionLink("Regresar", "Index", "Catalogos", null, new { @class = "btn btn-white" })
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@Html.Partial("~/Views/CatRubros/ModalActivarRubro.cshtml")
@Html.Partial("~/Views/CatRubros/ModalInactivarRubro.cshtml")

@section Scripts{

    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js "></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>
    @Scripts.Render("~/plugins/dataTables")

    <script src="~/Scripts/app/CatRubros/Index.js"></script>
    <script src="~/Scripts/plugins/parsley/parsley.min.js"></script>
    <script src="~/Scripts/plugins/parsley/parsley.es.js"></script>
    <script src="~/Scripts/plugins/parsley/validators/comparison.js"></script>
    <script>
		//Cargar costos
		cargarEgresos(true, true);

		//Cargar gastos
		cargarEgresos(false, true);

		function cargarEgresos(esCostos, SearchOrden) {
			$.ajax({
				url: '@Url.Action("Egresos", "CatRubros")',
				type: "GET",
				data: { esCostos: esCostos, filtroActivo: SearchOrden },
				success: function (result) {
					var contenedorId = esCostos == true ? "egresos-costos" : "egresos-gastos";
					$('#' + contenedorId).html(result);
				},
				error: function (xhr, ajaxOptions, thrownError) {
					//ShowAlert('danger', 'Error', ' Ocurrió un error, favor de contactar al administrador.', "Aceptar");
				}
			});
		}

		$(document).ready(function () {

			$(".btn-buscar-rubro").on("click", function (sender) {
				var esCostos = ($(this).attr('data-esCostos') == "true");
				var filtroEstatus = ($(".filtro-estatus-rubro[data-esCostos='" + esCostos + "'] option:selected").val() == "true");
				cargarEgresos(esCostos, filtroEstatus);
			});

			/*
			 * CREATE DE CONCEPTOS EN MODAL
			 * */
			$("#btn_AgregarConcepto").click(function () {

				$('#b_modal_title').text('Agregar Concepto');

				$.ajax({
					type: "Get",
					url: '@Url.Action("ModalCreateConcepto", controllerName)',
						success: function (result) {
						if (result.success == null) {
							$('#modal_body_preview').html(result);
							$('#modal_generic').modal('show');
						} else {
							if (result.message != null) {

								ShowAlert('danger', 'Error', result.message, "Aceptar");
							} else {
								ShowAlert('warning', 'Aviso', 'Registro no encontrado.', "Aceptar");
							}
						}
					},
						error: function (xhr, ajaxOptions, thrownError) {
							ShowAlert('danger', 'Error', ' Ocurrió un error, favor de contactar al administrador.', "Aceptar");
					}
				  });

			});
		});

    </script>



}

@section Styles {
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    <style>
        div.dataTables_wrapper div.dataTables_filter label {
            font-weight: normal;
            white-space: nowrap;
            text-align: left;
            /* margin-left: 73px; */
            margin-left: 9px;
        }

        div.dataTables_wrapper div.dataTables_filter {
            text-align: left;
        }

        .table-responsive {
            min-height: .01%;
            overflow-x: initial;
        }
    </style>
}