@using MystiqueMC.Helpers
@using MystiqueMC.Helpers.Permissions
@{
    /**/

    string rol = Session.ObtenerRol();
    PermissionsDelegate permissionsDelegate = new PermissionsDelegate(Session.ObtenerPermisos());
}
@model MystiqueMC.Models.Sucursal.SucursalViewModel

@{
    ViewBag.Title = "Agregar";
}
<link href="~/Content/build.css" rel="stylesheet" />
<style>
    [hidden] {
        display: none !important;
    }

    .red {
        color: red;
    }

    .black {
        color: black;
    }
</style>
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Agregar Sucursal</h2>
    </div>
    <div class="col-sm-8">
        <div class="title-action">
        </div>
    </div>
</div>

@using (Html.BeginForm("Create", "sucursales", FormMethod.Post, new { data_parsley_validate = "true", autocomplete = "off" }))
{
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">

            @Html.AntiForgeryToken()

            <div class="form-horizontal">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                <input type="hidden" name="comercioId" value="@Model.comercioId" />
                <input type="hidden" name="idDatoFiscal" value="@Model.idDatoFiscal" />
                <input type="hidden" name="idSucursal" value="@Model.idSucursal" />
                <input type="hidden" name="idDireccion" value="@Model.idDireccion" />
                <input type="hidden" name="idSucursalHorarioLunes" value="@Model.idSucursalHorarioLunes" />
                <input type="hidden" name="idSucursalHorarioMartes" value="@Model.idSucursalHorarioMartes" />
                <input type="hidden" name="idSucursalHorarioMiercoles" value="@Model.idSucursalHorarioMiercoles" />
                <input type="hidden" name="idSucursalHorarioJueves" value="@Model.idSucursalHorarioJueves" />
                <input type="hidden" name="idSucursalHorarioViernes" value="@Model.idSucursalHorarioViernes" />
                <input type="hidden" name="idSucursalHorarioSabado" value="@Model.idSucursalHorarioSabado" />
                <input type="hidden" name="idSucursalHorarioDomingo" value="@Model.idSucursalHorarioDomingo" />
                <div class="col-md-12">
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Nombre Sucursal</label>
                        @Html.EditorFor(model => model.nombre, new { htmlAttributes = new { @class = "form-control", @data_inputmask_regex = "[a-zA-ZñÑáéíóúÁÉÍÓÚ0-9 \\.'\\-]{0,100}", @data_inputmask_greedy = "false", @data_parsley_required = "", @data_parsley_maxlength = "100", @autocomplete = "off" } })
                        <label style="font-weight:lighter; color:black">
                        </label>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Calle</label>
                        <input name="calle" id="calle" type="text" class="form-control" maxlength="60" data-inputmask-regex="[a-zA-ZñÑáéíóúÁÉÍÓÚ0-9 \\.'\\-]{0,60}" data-inputmask-greedy="false"
                               data-parsley-required data-parsley-maxlength="60" autocomplete="off" />
                        <label style="font-weight:lighter; color:black">
                        </label>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Número Interior</label>
                        <input name="NoInterior" id="numInterior" type="text" class="form-control" maxlength="5" data-inputmask-regex="[a-zA-ZñÑ0-9 \\-]{0,5}" data-inputmask-greedy="false"
                               data-parsley-maxlength="5" autocomplete="off" />
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Número Exterior</label>
                        <input name="NoExterior" id="numExterior" type="text" class="form-control" maxlength="10" data-inputmask-regex="[0-9]{0,10}" data-inputmask-greedy="false"
                               data-parsley-maxlength="5" autocomplete="off" />
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Código Postal</label>
                        <input name="codigoPostal" id="cp" type="text" class="form-control" maxlength="5" data-inputmask-regex="[0-9]{0,5}" data-inputmask-greedy="false"
                               data-parsley-maxlength="5" autocomplete="off" />
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Colonia</label>
                        <input name="colonia" id="colonia" type="text" class="form-control" maxlength="60" data-inputmask-regex="[a-zA-ZñÑáéíóúÁÉÍÓÚ0-9 \\.'\\-]{0,60}" data-inputmask-greedy="false"
                               data-parsley-required data-parsley-maxlength="60" autocomplete="off" />
                        <label style="font-weight:lighter; color:black">
                        </label>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Entre Calles</label>
                        <input name="entreCalles" id="entreC" type="text" class="form-control" maxlength="60" data-inputmask-regex="[a-zA-ZñÑáéíóúÁÉÍÓÚ0-9 \\.'\\-]{0,60}" data-inputmask-greedy="false"
                               data-parsley-maxlength="60" autocomplete="off" />
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Estado</label>
                        @Html.DropDownList("estadoId", null, htmlAttributes: new { @class = "form-control", @data_parsley_required = "" })
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Ciudad</label>
                        @Html.DropDownList("ciudadId", null, htmlAttributes: new { @class = "form-control", @data_parsley_required = "" })
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Teléfono</label>
                        <input type="text" name="telefono" class="form-control" id="telefono"
                               maxlength=10 autocomplete="nope" data-parsley-required
                               data-parsley-errors-container="#telefono-error" data-inputmask-mask="(999) 999-99-99"
                               data-parsley-maxlength="10" />
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Punto Venta</label>
                        @Html.EditorFor(model => model.sucursalPuntoVenta, new { htmlAttributes = new { @class = "form-control", data_inputmask_regex = "[0-9]{0,5}", @autocomplete = "off", @data_parsley_required = "" } })
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <label class="control-label">Zona</label>
                        @Html.DropDownList("catZonaId", null, "Seleccione", htmlAttributes: new { @class = "form-control", @data_parsley_required = "" })
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col" style="margin-left: 15px;">
                        <label class="control-label">Color Indicador</label>
                        <input type="text" id="picker" name="picker" data-parsley-required data-parsley-errors-container="#error-color" />
                        <span id="error-color" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <div class="col-md-11">
                            <div class="col-md-2">
                                <label class="control-label">Horario</label>
                                <div class="checkbox checkbox-primary custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="lunes" name="diaLunes" value="Lunes">
                                    <label class="custum-control-label" for="customCheck1">Lunes</label>
                                </div>
                            </div>
                            <br />
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input type="text" class="form-control input-sm" id="horaI" name="HorarioInicioLunes" autocomplete="off" data_inputmask_regex="^[0-9]*$">
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                    <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;"><b>a</b></span>
                                    <input type="text" class="form-control input-sm" id="horaF" name="HorarioFinLunes" autocomplete="off" data_inputmask_regex="^[0-9]*$">
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-11">
                            <div class="col-md-2">
                                <div class="checkbox checkbox-primary custom-checkbox">
                                    <br />
                                    <input type="checkbox" class="custom-control-input" id="martes" name="diaMartes" value="Martes">
                                    <label class="custum-control-label" for="customCheck1">Martes</label>
                                </div>
                            </div>
                            <br />
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input id="horaI1" name="HorarioInicioMartes" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                    <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;"><b>a</b></span>
                                    <input id="horaF1" name="HorarioFinMartes" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-11">
                            <div class="col-md-2">
                                <div class="custom-checkbox checkbox checkbox-primary ">
                                    <br />
                                    <input type="checkbox" class="custom-control-input" id="miercoles" name="diaMiercoles" value="Miercoles">
                                    <label class="custum-control-label" for="customCheck1">Miércoles</label>
                                </div>
                            </div>
                            <br />
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input id="horaI2" name="HorarioInicioMiercoles" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                    <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;"><b>a</b></span>
                                    <input id="horaF2" name="HorarioFinMiercoles" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-11">
                            <div class="col-md-2">
                                <div class="checkbox checkbox-primary custom-checkbox">
                                    <br />
                                    <input type="checkbox" class="custom-control-input" id="jueves" name="diaJueves" value="Jueves">
                                    <label class="custum-control-label" for="customCheck1">Jueves</label>
                                </div>
                            </div>
                            <br />
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input id="horaI3" name="HorarioInicioJueves" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                    <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;"><b>a</b></span>
                                    <input id="horaF3" name="HorarioFinJueves" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-11">
                            <div class="col-md-2">
                                <div class="checkbox checkbox-primary custom-checkbox">
                                    <br />
                                    <input type="checkbox" class="custom-control-input" id="viernes" name="diaViernes" value="Viernes">
                                    <label class="custum-control-label" for="customCheck1">Viernes</label>
                                </div>
                            </div>
                            <br />
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input type="text" id="horaI4" name="HorarioInicioViernes" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                    <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;"><b>a</b></span>
                                    <input id="horaF4" name="HorarioFinViernes" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-11">
                            <div class="col-md-2">
                                <div class="checkbox checkbox-primary custom-checkbox">
                                    <br />
                                    <input type="checkbox" class="custom-control-input" id="sabado" name="diaSabado" value="Sabado">
                                    <label class="custum-control-label" for="customCheck1">Sabado</label>
                                </div>
                            </div>
                            <br />
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input id="horaI5" name="HorarioInicioSabado" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                    <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;"><b>a</b></span>
                                    <input id="horaF5" name="HorarioFinSabado" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-11">
                            <div class="col-md-2">
                                <div class="checkbox checkbox-primary custom-checkbox">
                                    <br />
                                    <input type="checkbox" class="custom-control-input" id="domingo" name="diaDomingo" value="Domingo">
                                    <label class="custum-control-label" for="customCheck1">Domingo</label>
                                </div>
                            </div>
                            <br />
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input id="horaI6" name="HorarioInicioDomingo" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                    <span class="input-group-addon" style="color:#000; background-color:transparent; border-color:transparent;"><b>a</b></span>
                                    <input id="horaF6" name="HorarioFinDomingo" class="form-control" autocomplete="off" data_inputmask_regex="^[0-9]*$" />
                                    <span class="input-group-addon">
                                        <span class="fa fa-clock"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <input id="Latitud" name="latitud" type="text" hidden />
                <input id="Longitud" name="longitud" type="text" hidden />
                <input id="PlaceId" name="placeId" type="text" hidden />
                <br /><br />
                <label class="control-label">Ubicación</label>
                <div><input id="BuscarUbicacion" type="text" style="height: 23px; width: 80%; margin-top: 10px;" /></div>
                <div id="map" style="height: 335px; width: 50%;"></div>
            </div>

        </div>

        <div class="row">
                <div class="col-md-12">
                    <a href="@Url.Action("Index", "sucursales", new { IdComercio = @ViewBag.idcomecio })" class="btn btn-white m-r-sm">Regresar</a>

                    @if (permissionsDelegate.HasPermissionForController(rol, HttpContext.Current.Request.RequestContext.RouteData.Values["controller"].ToString()))
                    {
                        <input type="submit" value="Guardar" class="btn btn-primary" />
                    }
                </div>
        </div>
    </div>
}
@section Styles{
    <link href="~/Content/timePicker.css" rel="stylesheet" />
    <link href="~/Content/plugins/datepicker/datepicker3.css" rel="stylesheet" />
    <link href="~/Content/plugins/bootstrap-duallistbox/bootstrap-duallistbox.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/plugins/cropper/cropper.min.css" rel="stylesheet" type="text/css" />

    <link href="//cdn.kendostatic.com/2013.1.319/styles/kendo.common.min.css" rel="stylesheet" />
    <link href="//cdn.kendostatic.com/2013.1.319/styles/kendo.default.min.css" rel="stylesheet" />
    <style>

        .demo-section {
            height: 600px;
            width: 600px;
        }

        #background {
            background: transparent url(../content/web/colorpicker/interior-bg.png) no-repeat;
            margin: 0 auto;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .column {
            margin-top: 384px;
            float: left;
            width: 300px;
            text-align: center;
        }

            .column .title {
                color: #a3a3a3;
                text-transform: uppercase;
                font-size: 11px;
                font-weight: normal;
                padding: 41px 0 20px;
            }

        #palette {
            vertical-align: top;
            display: inline-block;
        }

        .k-colorpicker {
            vertical-align: top;
            /*margin: 20px 0;*/
            margin-left: -104px;
            margin-top: 27px;
        }

            .k-colorpicker .k-selected-color {
                font-size: 0;
                vertical-align: top;
                line-height: 0;
                display: inline-block;
                height: 26px;
                width: 225px;
            }
    </style>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script src="~/Scripts/inputmask.js"></script>
    <script src="~/Scripts/inputmask.min.js"></script>
    <script src="~/Content/js/inputmask.js"></script>
    <script src="~/Scripts/plugins/inputmask/inputmask.js"></script>
    <script src="~/Scripts/plugins/inputmask/inputmask.min.js"></script>
    <script src="~/Scripts/jquery.timePicker.js"></script>
    <script src="~/Scripts/jquery.timePicker.min.js"></script>
    <script src="~/Scripts/app/Sucursales/Create.js"></script>
    <script src="~/Scripts/plugins/parsley/parsley.min.js"></script>
    <script src="~/Scripts/plugins/parsley/parsley.es.js"></script>
    <script src="~/Scripts/plugins/parsley/validators/comparison.js"></script>
    <script src="~/Scripts/plugins/cropper/cropper.min.js"></script>
    <script src="~/Scripts/plugins/cropper/cropper.jquery.min.js"></script>
    <script src="~/Scripts/plugins/bootstrap-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>

    <script>
        $('#horaI,#horaF,#horaF1,#horaI1,#horaI2,#horaF2,#horaF3,#horaI3,#horaF4,#horaI4,#horaF5,#horaI5,#horaF6,#horaI6').timepicker({
            timeFormat: 'h:mm p',
            interval: 30,
            step: 50,
            dynamic: false,
            dropdown: true,
            scrollbar: true
        });
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            $(".pac-container").css("background-color", "red");
        })
    </script>
    <style type="text/css">
        .RadUpload, .RadUploadProgressArea {
            text-align: center !important;
        }
    </style>

    <script type="text/javascript">
        var infoWindow;
        var marker;
        var markers = [];
        var input = document.getElementById('BuscarUbicacion');
        var coordenadas = { lat: 32.6393437, lng: -115.4492573 };
        document.getElementById("Latitud").value = coordenadas.lat;
        document.getElementById("Longitud").value = coordenadas.lng;
        document.getElementById("PlaceId").value = "ChIJI7n_mZVH2YARooYtxbJApBw";

        function initMap(place) {



            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: coordenadas,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });

            var marker = new google.maps.Marker({
                position: coordenadas,
                map: map
            });
            marker.setMap(map);

            map.addListener('click', function (event) {
                infoWindow.close();
                addMarker(event.latLng);
            });

            infoWindow = new google.maps.InfoWindow();

            google.maps.event.addListener(infoWindow, 'domready', function () {
                map.setCenter(markers[0].getPosition());
            });
            infoWindow.open(map, markers[0]);

            input = (document.getElementById('BuscarUbicacion'));
            var autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.bindTo('bounds', map);
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
            var infowindow = new google.maps.InfoWindow();
            var marker = new google.maps.Marker({
                map: map
            });

            google.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });

            google.maps.event.addListener(autocomplete, 'place_changed', function () {

                clearMarkers();
                infowindow.close();
                markers[0] = new google.maps.Marker({
                    map: map
                });

                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    return;
                }

                if (place.geometry.viewport) {
                    map.fitBounds(place.geometry.viewport);
                } else {
                    map.setCenter(place.geometry.location);
                }

                markers[0].setPlace(({
                    placeId: place.place_id,
                    location: place.geometry.location
                }));

                document.getElementById("Latitud").value = place.geometry.location.lat();
                document.getElementById("Longitud").value = place.geometry.location.lng();
                document.getElementById("PlaceId").value = place.place_id;

                infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + place.formatted_address + '</div>');
                infowindow.open(map, markers[0]);
            });

            function clearMarkers() {
                setMapOnAll(null);
            }
            function addMarker(location) {
                var geocoder = new google.maps.Geocoder;
                var marker = new google.maps.Marker({
                    position: location,
                    map: map
                });
                geocoder.geocode({ 'location': location }, function (results, status) {
                    if (status === 'OK') {
                        if (results[0]) {
                            document.getElementById("Latitud").value = location.lat();
                            document.getElementById("Longitud").value = location.lng();
                            document.getElementById("PlaceId").value = results[0].place_id;
                            var direccion = " ";
                            var direccionSplit = results[0].formatted_address.split(",");
                            for (var x = 0; x < direccionSplit.length; x++) {
                                direccion += direccionSplit[x] + "<br>";
                            }

                            infoWindow.setContent(direccion);
                            infoWindow.open(map, marker);
                        } else {
                            window.alert('No results found');
                        }
                    } else {
                        window.alert('Geocoder failed due to: ' + status);
                    }
                });
                clearMarkers();
                markers.push(marker);
            }

            function setMapOnAll(map) {
                for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(map);
                }
            }
        }
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#telefono").inputmask("mask", { "mask": "(999) 999-99-99" });
        });
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            $(".pac-container").css("background-color", "red");
        })
    </script>

    @*<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.js"></script>*@
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBg48XXQ0WFCA0v2HpC4zs7EYEetu5ZAoc&callback=initMap&libraries=geometry,places"
            async desc></script>

    <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="//cdn.kendostatic.com/2013.1.319/js/kendo.all.min.js"></script>
    <script>
        function preview(e) {
            $("#background").css("background-color", e.value);
        }

        $("#picker").kendoColorPicker({
            value: "",
            buttons: false,
            select: preview
        });

        var color = document.getElementById("nombre").value
    </script>

}


