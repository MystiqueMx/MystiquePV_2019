@using MystiqueMC.Helpers
@using MystiqueMC.Helpers.Permissions
@{
    string rol = Session.ObtenerRol();
    PermissionsDelegate permissionsDelegate = new PermissionsDelegate(Session.ObtenerPermisos());
}
@model IEnumerable<MystiqueMC.DAL.SP_PV_Reporte_Consumo_Agrupado_Detalle_Result>
@{
    ViewBag.Title = "Reporte Consumo Agrupado Detallado";
}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Reporte Consumo X Venta Detallado</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group col-lg-3">
                            <label><i aria-hidden="true"></i> Familia </label><br />
                            <span>@ViewBag.familia</span>
                        </div>
                        <div class="form-group col-lg-3">
                            <label><i aria-hidden="true"></i> Ventas </label><br />
                            @ViewBag.ventas.ToString("N2")
                        </div>
                        <div class="form-group col-lg-3">
                            <label><i aria-hidden="true"></i> Frecuencia</label><br />
                            @ViewBag.frecuencia
                        </div>
                        <div class="form-group col-lg-3">
                            <label><i aria-hidden="true"></i>Porcentaje Ventas </label><br />
                            @ViewBag.porcentaje.ToString("0.00")
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <div class="table-responsive">
                        <table id="ContentTable" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>
                                        Producto
                                    </th>
                                    <th class="text-right">
                                        Ventas
                                    </th>
                                    <th class="text-right">
                                        Precio
                                    </th>
                                    <th style="text-align: center;">
                                        Frecuencia
                                    </th>
                                    <th class="text-right">
                                        Porcentaje Ventas
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Producto)
                                        </td>
                                        <td class="text-right">
                                            @item.Ventas.Value.ToString("N2")
                                        </td>
                                        <td class="text-right">
                                            @item.precio.Value.ToString("N2")
                                        </td>
                                        <td style="text-align: center;">
                                            @Html.DisplayFor(modelItem => item.Frecuencia)
                                        </td>
                                        <td class="text-right">
                                            @item.porcentajeVenta.Value.ToString("0.00")
                                        </td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th class="text-right" colspan="1">
                                        Total:
                                    </th>
                                    <td class="text-right">
                                        @((Model.AsEnumerable().Sum(c => c.Ventas).Value.ToString("N2")))
                                    </td>
                                    <td>
                                       
                                    </td>
                                    <td></td>
                                    <td class="text-right">
                                        @((Model.AsEnumerable().Sum(c => c.porcentajeVenta).Value.ToString("0.00")))
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @Html.ActionLink("Regresar", "ReporteConsumoAgrupado", new {
    fecha1 = ViewBag.fechaInicio,
    fecha2 = ViewBag.fechaFin,
    Sucursales = ViewBag.Sucursales, Familia = ViewBag.familias }, new { @class = "btn btn-white" })
</div>

@section Scripts{
    <script src="~/Scripts/bootstrap-datepicker.js"></script>

    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js "></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>

    <script>
        $(document).ready(function () {

            $('#ContentTable').DataTable({
                "dom": '<lB<t>ip>',
                "ordering": false,
                "buttons": [
                    {
                        extend: 'excelHtml5',
                        text: '<span id="realExcel" style="display:none" class="btn btn-primary btn-sm">Excel<span>',
                        titleAttr: ''
                    },
                ],
                "pageLength": 100,
                "language": {
                    "search": "Buscar   ",
                    "lengthMenu": "Elementos por página:  _MENU_",
                    "info": "Mostrando _START_ - _END_ de _TOTAL_ elementos",
                    "emptyTable": "No hay información",
                    "paginate": {
                        "first": "Primera",
                        "last": "Ultima",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    }
                }
            });

        });
    </script>

    <script>
        jQuery(document).ready(function ($) {
            $('#fecha').datepicker({
                language: 'es',
                Format: "mm/dd/yy",
                changeMonth: true,
                changeYear: true,
                yearRange: "-60:+0"
            });
        });
        jQuery(document).ready(function ($) {
            $('#fecha2').datepicker({
                language: 'es',
                Format: "mm/dd/yy",
                changeMonth: true,
                changeYear: true,
                yearRange: "-60:+0"
            });
        });
    </script>

    <script>
        $('#fecha').on("change", function () {
            var startVal = $('#fecha').val();
            $('#fecha2').data('datepicker').setStartDate(startVal);
        });
        $('#fecha2').on("change", function () {
            var endVal = $('#fecha2').val();
            $('#fecha').data('datepicker').setEndDate(endVal);
        });

    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('.input-daterange').datepicker({
            });
        });
    </script>
}
@section Styles {
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
}