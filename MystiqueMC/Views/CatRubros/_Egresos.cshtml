@model MystiqueMC.Models.Rubros.RubrosIndexViewModel
@{
	ViewBag.Title = "Index";
	var idTable = (bool)ViewBag.esCostos ? "ContentTable-Costos" : "ContentTable-Gastos";
}
<style>
	td.details-control {
		padding-left: 10px !important;
		font-size: 16px;
		cursor: pointer;
	}
</style>
<table id="@idTable" class="table table-striped tabla-catalogos display responsive no-wrap" width="100%">
	<thead>
		<tr>
			@if (!ViewBag.esCostos)
			{
				<text>
				<th class="details-control"></th>
				</text>
			}
			<th>
				Descripción
			</th>

			<th style="text-align:right">
				Ponderación (%)
			</th>

			<th class="text-right " data-orderable="false"></th>
		</tr>
	</thead>
	<tbody>
		@foreach (var item in Model.RubrosVM)
		{
			<tr id="@item.IdCatRubro">
				@if (!ViewBag.esCostos)
				{
					<text>
					<td class="details-control">
						<div class="collapse-button">
							<i class="fa fa-plus-square"></i>
						</div>
					</td>
					</text>
				}
				<td>
					@Html.DisplayFor(modelItem => item.Descripcion)
				</td>

				<td style="text-align:right">
					@Html.DisplayFor(modelItem => item.Ponderacion)
				</td>

				<td class="text-right">
					<button type="button" class="btn btn-link" data-toggle="modal"
							data-target="@if (item.Activo) { <text>#modal-inactivar-rubro</text> }else{ <text>#modal-activar-rubro</text> }"
							data-id="@item.IdCatRubro" data-descripcion="@item.Descripcion">
						@if (item.Activo)
						{
							<img src="~/Content/Images/on.png" style="width: 30px;">
						}
						else
						{
							<img src="~/Content/Images/off.png" style="width: 30px;">
						}
					</button>
					<a href="@Url.Action("Edit", new {id = item.IdCatRubro})" class="href-gray m-r-sm" data-tippy="Editar"><img src="~/Content/img/editar.png" /></a>
					<a href="@Url.Action("Delete", new {id = item.IdCatRubro})" class="href-gray m-r-sm" data-tippy="Desactivar"><img src="~/Content/img/borrar.png" /></a>
				</td>
			</tr>
		}
	</tbody>
	<tfoot>
		<tr>
			<td></td>
			<td class="text-right">
				<b>Total: @Model.TotalPonderacionFormateado %</b>
			</td>
			<td></td>
		</tr>
		<tr>
			<th colspan="4">
				@if (ViewBag.esCostos)
				{
					<br /><span>Nota: la ponderación en costos no debería ser mayo a 35%</span>
				}
				else
				{
					<br /><span>Nota: la ponderación en gastos no debería ser mayo a 40%</span>
				}
			</th>
		</tr>
	</tfoot>
</table>

<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js "></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>
@Scripts.Render("~/plugins/dataTables")
<script>
	$(document).ready(function () {
		
		var groupColumn = 1;
		var table = $('#@idTable').DataTable({
			"dom": 'T<"clear">lrtip',
			"pageLength": 100,
			"tableTools": {
				"sSwfPath": "../scripts/plugins/dataTables/swf/copy_csv_xls_pdf.swf"
			},
			"language": {
				"search": "Buscar ",
				"lengthMenu": "Elementos por página:  _MENU_",
				"info": "Mostrando _START_ - _END_ de _TOTAL_ elementos",
				"emptyTable": "No hay información",
				"paginate": {
					"first": "Primera",
					"last": "Ultima",
					"next": "Siguiente",
					"previous": "Anterior"
				}
			}
		});

		function format(catRubroId) {
			var tableContent = $('<div/>');
			$.ajax({
				url: '@Url.Action("Conceptos", "CatRubros")',
				type: "GET",
				data: {
					catRubroId: catRubroId
				},
				success: function (result) {
					tableContent.html(result);
				}
			});

			return tableContent;
		}

		$('#@idTable tbody').on('click', 'td.details-control', function () {
			var tr = $(this).closest('tr');
			var row = table.row(tr);
			var collapseButton = $(this).closest('td').find('.collapse-button');
			if (row.child.isShown()) {
				row.child.hide();
				tr.removeClass('shown');
				collapseButton.html('<i class="fa fa-plus-square"></i>');
			}
			else {
				row.child(format(tr.attr('id'))).show();
				tr.addClass('shown');
				collapseButton.html('<i class="fa fa-minus-square"></i>');
			}
		});
	});
</script>